import{r as c,j as s}from"./index-CJkOyCGS.js";const L=({nodes:r,selectedPath:o,onNodeSelect:p,className:b=""})=>{const[j,m]=c.useState(null),[v,d]=c.useState(1),[f,N]=c.useState({x:0,y:0}),{svgWidth:u,svgHeight:g,nodeSpacing:C}=c.useMemo(()=>{if(r.length===0)return{svgWidth:800,svgHeight:400,nodeSpacing:{x:150,y:100}};const t=r.map(h=>h.position.x),i=r.map(h=>h.position.y),e=Math.max(...t),a=Math.max(...i),n=Math.min(...t),l=Math.min(...i),x=Math.max(1200,e-n+200),y=Math.max(600,a-l+200),S={x:Math.max(180,x/Math.max(1,Math.ceil(Math.sqrt(r.length)))),y:Math.max(120,y/Math.max(1,Math.ceil(r.length/6)))};return{svgWidth:x,svgHeight:y,nodeSpacing:S}},[r]),w=c.useMemo(()=>(t,i=!1)=>t.isCurrent?i?"#a855f7":"#8b5cf6":t.isVisited?i?"#6366f1":"#4f46e5":t.isAvailable?i?"#7c3aed":"#6366f1":i?"#4b5563":"#374151",[]),k=c.useMemo(()=>(t,i)=>{const e=o.includes(t.id)&&o.includes(i.id),a=t.isVisited&&i.isVisited,n=t.isCurrent;return e?"#a855f7":n?"#06b6d4":a?"#64748b":"#374151"},[o]),M=()=>r.flatMap(t=>t.connections.map(i=>{const e=r.find(x=>x.id===i);if(!e)return null;const a=k(t,e),n=o.includes(t.id)&&o.includes(e.id),l=t.isCurrent;return s.jsxs("g",{children:[s.jsx("line",{x1:t.position.x,y1:t.position.y,x2:e.position.x,y2:e.position.y,stroke:a,strokeWidth:n?4:l?3:2,strokeDasharray:e.isVisited?"none":"8,4",className:"transition-all duration-500 ease-in-out",style:{filter:n?"drop-shadow(0 0 8px rgba(168, 85, 247, 0.6))":"none",opacity:n?1:.7}}),s.jsx("polygon",{points:`${e.position.x-8},${e.position.y-4} ${e.position.x},${e.position.y} ${e.position.x-8},${e.position.y+4}`,fill:a,className:"transition-all duration-300",style:{filter:n?"drop-shadow(0 0 4px rgba(168, 85, 247, 0.8))":"none"}})]},`${t.id}-${i}`)}).filter(Boolean)),$=()=>r.map(t=>{const i=o.includes(t.id),e=j===t.id,a=w(t,e),n=45,l=Math.min(C.x*.8,120);return s.jsxs("g",{className:"cursor-pointer group",onMouseEnter:()=>m(t.id),onMouseLeave:()=>m(null),children:[(t.isCurrent||e)&&s.jsx("circle",{cx:t.position.x,cy:t.position.y,r:t.isCurrent?28:24,fill:"none",stroke:t.isCurrent?"#a855f7":"#06b6d4",strokeWidth:"2",className:"opacity-60",style:{filter:"blur(4px)"}}),s.jsx("circle",{cx:t.position.x,cy:t.position.y,r:t.isCurrent?18:14,fill:a,stroke:i?"#c084fc":e?"#06b6d4":"#1f2937",strokeWidth:i?4:e?3:2,className:"transition-all duration-300 ease-in-out",onClick:()=>p&&p(t.id),style:{filter:t.isCurrent?"drop-shadow(0 0 12px rgba(168, 85, 247, 0.8))":e?"drop-shadow(0 0 8px rgba(6, 182, 212, 0.6))":"none",transform:e?"scale(1.1)":"scale(1)",transformOrigin:"center"}}),t.isVisited&&!t.isCurrent&&s.jsx("circle",{cx:t.position.x+8,cy:t.position.y-8,r:"4",fill:"#10b981",className:"transition-opacity duration-300"}),s.jsx("foreignObject",{x:t.position.x-l/2,y:t.position.y+n,width:l,height:"60",className:"pointer-events-none",children:s.jsx("div",{className:"text-center text-xs font-medium transition-all duration-300 p-1 rounded",style:{fontSize:e?"12px":"10px",color:e?"#ffffff":"#cbd5e1",backgroundColor:e?"rgba(0, 0, 0, 0.7)":"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(4px)",lineHeight:"1.2",wordWrap:"break-word",filter:e?"drop-shadow(0 0 4px rgba(255, 255, 255, 0.8))":"none"},children:t.title})}),t.isCurrent&&s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:t.position.x,cy:t.position.y,r:"25",fill:"none",stroke:"#06b6d4",strokeWidth:"1",strokeDasharray:"4,4",className:"opacity-70",style:{animation:"spin 20s linear infinite"}}),s.jsx("circle",{cx:t.position.x,cy:t.position.y,r:"30",fill:"none",stroke:"#a855f7",strokeWidth:"1",strokeDasharray:"2,6",className:"opacity-50",style:{animation:"spin 30s linear infinite reverse"}})]})]},t.id)}),O=()=>d(t=>Math.min(t*1.2,3)),W=()=>d(t=>Math.max(t/1.2,.3)),V=()=>{d(1),N({x:0,y:0})};return s.jsxs("div",{className:`visual-branch-tracker relative ${b}`,children:[s.jsxs("div",{className:"bg-gray-900 bg-opacity-90 backdrop-blur-sm rounded-lg p-4 border border-gray-700",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center",children:[s.jsx("span",{className:"mr-2",children:"ðŸŒŒ"}),"Quantum Narrative Map"]}),s.jsxs("div",{className:"text-xs text-gray-400",children:[r.filter(t=>t.isVisited).length," / ",r.length," nodes explored"]})]}),s.jsx("div",{className:"overflow-x-auto overflow-y-auto max-h-96 border border-gray-600 rounded bg-gray-950",children:s.jsx("svg",{width:u,height:g,viewBox:`0 0 ${u} ${g}`,className:"w-full h-auto",style:{minHeight:"400px",transform:`scale(${v})`,transformOrigin:"center center"},children:s.jsxs("g",{transform:`translate(${f.x}, ${f.y})`,children:[s.jsxs("defs",{children:[s.jsx("pattern",{id:"grid",width:"50",height:"50",patternUnits:"userSpaceOnUse",children:s.jsx("path",{d:"M 50 0 L 0 0 0 50",fill:"none",stroke:"#1f2937",strokeWidth:"1",opacity:"0.3"})}),s.jsxs("radialGradient",{id:"quantumField",cx:"50%",cy:"50%",r:"50%",children:[s.jsx("stop",{offset:"0%",stopColor:"#1e1b4b",stopOpacity:"0.1"}),s.jsx("stop",{offset:"50%",stopColor:"#312e81",stopOpacity:"0.05"}),s.jsx("stop",{offset:"100%",stopColor:"#0f0f23",stopOpacity:"0.2"})]})]}),s.jsx("rect",{width:"100%",height:"100%",fill:"url(#quantumField)"}),s.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)"}),s.jsx("g",{className:"connections",children:M()}),s.jsx("g",{className:"nodes",children:$()})]})})}),s.jsxs("div",{className:"absolute top-16 right-6 flex flex-col gap-2",children:[s.jsx("button",{onClick:O,className:"bg-gray-700 hover:bg-gray-600 text-white font-bold py-1 px-2 rounded text-xs",children:"+"}),s.jsx("button",{onClick:W,className:"bg-gray-700 hover:bg-gray-600 text-white font-bold py-1 px-2 rounded text-xs",children:"-"}),s.jsx("button",{onClick:V,className:"bg-gray-700 hover:bg-gray-600 text-white font-bold py-1 px-2 rounded text-xs",children:"Reset"})]}),s.jsxs("div",{className:"mt-3 flex flex-wrap gap-4 text-xs text-gray-400",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-3 h-3 rounded-full bg-purple-500 mr-1"}),"Current"]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-3 h-3 rounded-full bg-indigo-500 mr-1"}),"Visited"]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500 mr-1"}),"Available"]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-500 mr-1"}),"Locked"]})]})]}),s.jsx("style",{dangerouslySetInnerHTML:{__html:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        `}})]})};export{L as default};
