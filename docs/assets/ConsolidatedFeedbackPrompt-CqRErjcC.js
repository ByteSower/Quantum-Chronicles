import{r as n,a as y,j as e}from"./index-D0CNa7_0.js";const z=({isVisible:p,milestone:r,sessionData:l,onSubmit:F,onDismiss:f})=>{const[m,N]=n.useState(0),[x,h]=n.useState({}),[c,d]=n.useState({general:"",likes:"",improvements:"",suggestions:""}),[u,k]=n.useState([]),[v,w]=n.useState(!1),[i,j]=n.useState(0);n.useEffect(()=>{p&&(N(0),h({}),d({general:"",likes:"",improvements:"",suggestions:""}),k([]),j(0),y.announce(`Feedback form opened for ${r.name}`,"polite"))},[p,r.name]);const g=r.consolidatedPrompt.sections,$=i===g.length-1,S=i===0,q=async()=>{if(m===0)return;w(!0);const s={overallRating:m,ratings:x,comments:c,quickResponses:u,milestone:r.id,sessionDuration:l.sessionDuration||0,choiceCount:l.choiceCount||0,segmentsReached:l.segmentsReached||[],timestamp:Date.now(),qnceVariables:l.qnceVariables};try{F(s),y.announce("Thank you for your comprehensive feedback!","polite")}catch(t){console.error("Failed to submit feedback:",t),y.announce("Feedback submission failed. Please try again.","assertive")}finally{w(!1)}},R=s=>{k(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},b=(s,t,a,P)=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-slate-300 text-sm mb-2",children:[a,":"]}),e.jsx("div",{className:"flex justify-center gap-1",role:"radiogroup","aria-label":`${a} rating from 1 to 5 stars`,children:[1,2,3,4,5].map(o=>e.jsx("button",{onClick:()=>t(o),onKeyDown:C=>{C.key==="ArrowLeft"&&o>1&&t(o-1),C.key==="ArrowRight"&&o<5&&t(o+1)},className:`text-2xl transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-opacity-50 rounded ${o<=s?"text-yellow-400 hover:text-yellow-300":"text-gray-600 hover:text-gray-500"}`,"aria-label":`${o} star${o>1?"s":""}`,"aria-pressed":o<=s,role:"radio","aria-checked":o===s,id:`${P}-star-${o}`,children:"★"},o))})]}),L=s=>{switch(s){case"overall":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-indigo-300",children:"Overall Experience"}),b(m,N,"How would you rate your overall experience","overall"),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"general-comment",className:"block text-slate-300 text-sm mb-2",children:"General thoughts (optional):"}),e.jsx("textarea",{id:"general-comment",value:c.general,onChange:t=>d(a=>({...a,general:t.target.value})),placeholder:"Share your overall thoughts about Quantum Chronicles...",className:"w-full p-3 bg-slate-700/50 border border-slate-600/50 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-400 resize-none",rows:3,maxLength:300}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[c.general.length,"/300 characters"]})]})]});case"story":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-indigo-300",children:"Story & Narrative"}),b(x.story||0,t=>h(a=>({...a,story:t})),"How engaging was the story","story"),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"likes-comment",className:"block text-slate-300 text-sm mb-2",children:"What did you enjoy most?"}),e.jsx("textarea",{id:"likes-comment",value:c.likes,onChange:t=>d(a=>({...a,likes:t.target.value})),placeholder:"Tell us what you loved about the story...",className:"w-full p-3 bg-slate-700/50 border border-slate-600/50 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-400 resize-none",rows:2,maxLength:200})]})]});case"choices":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-indigo-300",children:"Choices & Interaction"}),b(x.choices||0,t=>h(a=>({...a,choices:t})),"How did the choice system feel","choices"),e.jsxs("div",{className:"bg-slate-700/30 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-slate-300 mb-1",children:["Your session: ",l.choiceCount," choices made"]}),l.qnceVariables&&e.jsxs("div",{className:"text-xs text-slate-400",children:["Variables: Curiosity ",l.qnceVariables.curiosity,", Coherence ",l.qnceVariables.coherence,", Disruption ",l.qnceVariables.disruption,", Synchrony ",l.qnceVariables.synchrony]})]})]});case"interface":case"onboarding":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-indigo-300",children:s==="interface"?"User Interface":"Getting Started"}),b(x[s]||0,t=>h(a=>({...a,[s]:t})),s==="interface"?"How intuitive was the interface":"How clear was the onboarding",s)]});case"suggestions":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-indigo-300",children:"Your Suggestions"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"improvements-comment",className:"block text-slate-300 text-sm mb-2",children:"What could be improved?"}),e.jsx("textarea",{id:"improvements-comment",value:c.improvements,onChange:t=>d(a=>({...a,improvements:t.target.value})),placeholder:"Share your ideas for improvement...",className:"w-full p-3 bg-slate-700/50 border border-slate-600/50 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-400 resize-none",rows:2,maxLength:200})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"suggestions-comment",className:"block text-slate-300 text-sm mb-2",children:"Feature suggestions:"}),e.jsx("textarea",{id:"suggestions-comment",value:c.suggestions,onChange:t=>d(a=>({...a,suggestions:t.target.value})),placeholder:"What features would you like to see?",className:"w-full p-3 bg-slate-700/50 border border-slate-600/50 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-400 resize-none",rows:2,maxLength:200})]})]});default:return null}};return p?e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"consolidated-feedback-title",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-60 backdrop-blur-sm transition-opacity duration-300",onClick:f,"aria-hidden":"true"}),e.jsxs("div",{className:"relative bg-gradient-to-br from-slate-800 to-slate-900 border border-indigo-500/30 rounded-xl shadow-2xl p-6 max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto transform transition-all duration-300",children:[e.jsx("button",{onClick:f,className:"absolute top-4 right-4 text-slate-400 hover:text-white transition-colors duration-200 z-10","aria-label":"Close feedback form",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"mb-6 pr-8",children:[e.jsx("h3",{id:"consolidated-feedback-title",className:"text-xl font-bold mb-2 bg-gradient-to-r from-indigo-300 to-purple-300 bg-clip-text text-transparent",children:r.consolidatedPrompt.title}),e.jsx("p",{className:"text-slate-300 text-sm",children:r.consolidatedPrompt.description}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("div",{className:"flex space-x-2",children:g.map((s,t)=>e.jsx("div",{className:`w-2 h-2 rounded-full transition-colors duration-200 ${t===i?"bg-indigo-400":t<i?"bg-indigo-600":"bg-slate-600"}`},t))})})]}),i===0&&r.consolidatedPrompt.quickOptions.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-slate-300 text-sm mb-3",children:"Quick feedback (select all that apply):"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:r.consolidatedPrompt.quickOptions.map((s,t)=>e.jsx("button",{onClick:()=>R(s),className:`p-3 rounded-lg text-sm text-left transition-all duration-200 ${u.includes(s)?"bg-indigo-600 text-white border border-indigo-500":"bg-slate-700/50 text-slate-300 hover:bg-slate-600/50 border border-slate-600/50"}`,"aria-pressed":u.includes(s),children:e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:`mr-2 ${u.includes(s)?"text-white":"text-slate-500"}`,children:u.includes(s)?"✓":"○"}),s]})},t))})]}),g[i]&&e.jsx("div",{className:"mb-6",children:L(g[i])}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:()=>j(s=>Math.max(0,s-1)),disabled:S,className:`px-4 py-2 text-sm rounded-lg transition-colors duration-200 ${S?"text-slate-500 cursor-not-allowed":"text-indigo-300 hover:text-indigo-200 hover:bg-slate-700/50"}`,children:"Previous"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:f,className:"px-4 py-2 text-sm text-slate-400 hover:text-white transition-colors duration-200",disabled:v,children:"Skip"}),$?e.jsx("button",{onClick:q,disabled:v||m===0,className:"px-6 py-2 text-sm bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-lg font-semibold transition-all duration-300 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Submitting...":"Submit Feedback"}):e.jsx("button",{onClick:()=>j(s=>s+1),className:"px-6 py-2 text-sm bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-lg font-semibold transition-all duration-300 shadow-lg",children:"Next"})]})]})]})]}):null};export{z as default};
