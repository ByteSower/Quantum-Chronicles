import{r as n,a as y,j as e}from"./index-DYw4sHiA.js";const z=({isVisible:p,milestone:i,sessionData:l,onSubmit:F,onDismiss:f})=>{const[v,k]=n.useState(0),[m,g]=n.useState({}),[c,d]=n.useState({general:"",likes:"",improvements:"",suggestions:""}),[u,N]=n.useState([]),[x,w]=n.useState(!1),[r,j]=n.useState(0);n.useEffect(()=>{p&&(k(0),g({}),d({general:"",likes:"",improvements:"",suggestions:""}),N([]),j(0),y.announce(`Feedback form opened for ${i.name}`,"polite"))},[p,i.name]);const h=i.consolidatedPrompt.sections,R=r===h.length-1,S=r===0,$=async()=>{console.log("ðŸŽ¯ Feedback submit attempted - overallRating:",v,"isSubmitting:",x),w(!0);const t={overallRating:v,ratings:m,comments:c,quickResponses:u,milestone:i.id,sessionDuration:l.sessionDuration||0,choiceCount:l.choiceCount||0,segmentsReached:l.segmentsReached||[],timestamp:Date.now(),qnceVariables:l.qnceVariables};try{console.log("ðŸŽ¯ Calling onSubmit with feedback data:",t),F(t),y.announce("Thank you for your comprehensive feedback!","polite")}catch(s){console.error("Failed to submit feedback:",s),y.announce("Feedback submission failed. Please try again.","assertive")}finally{w(!1)}},q=t=>{N(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},b=(t,s,a,P)=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-slate-300 text-sm mb-2",children:[a,":"]}),e.jsx("div",{className:"flex justify-center gap-1",role:"radiogroup","aria-label":`${a} rating from 1 to 5 stars`,children:[1,2,3,4,5].map(o=>e.jsx("button",{onClick:()=>{console.log("â­ Star clicked:",o,"for",a),s(o)},onKeyDown:C=>{C.key==="ArrowLeft"&&o>1&&s(o-1),C.key==="ArrowRight"&&o<5&&s(o+1)},className:`text-2xl transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-opacity-50 rounded ${o<=t?"text-yellow-400 hover:text-yellow-300":"text-gray-600 hover:text-gray-500"}`,"aria-label":`${o} star${o>1?"s":""}`,"aria-pressed":o<=t,role:"radio","aria-checked":o===t,id:`${P}-star-${o}`,children:"â˜…"},o))})]}),L=t=>{switch(t){case"overall":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-indigo-300",children:"Overall Experience"}),b(v,k,"How would you rate your overall experience (optional)","overall"),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"general-comment",className:"block text-slate-300 text-sm mb-2",children:"General thoughts (optional):"}),e.jsx("textarea",{id:"general-comment",value:c.general,onChange:s=>d(a=>({...a,general:s.target.value})),placeholder:"Share your overall thoughts about Quantum Chronicles...",className:"w-full p-3 bg-slate-700/50 border border-slate-600/50 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-400 resize-none",rows:3,maxLength:300}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[c.general.length,"/300 characters"]})]})]});case"story":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-indigo-300",children:"Story & Narrative"}),b(m.story||0,s=>g(a=>({...a,story:s})),"How engaging was the story","story"),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"likes-comment",className:"block text-slate-300 text-sm mb-2",children:"What did you enjoy most?"}),e.jsx("textarea",{id:"likes-comment",value:c.likes,onChange:s=>d(a=>({...a,likes:s.target.value})),placeholder:"Tell us what you loved about the story...",className:"w-full p-3 bg-slate-700/50 border border-slate-600/50 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-400 resize-none",rows:2,maxLength:200})]})]});case"choices":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-indigo-300",children:"Choices & Interaction"}),b(m.choices||0,s=>g(a=>({...a,choices:s})),"How did the choice system feel","choices"),e.jsxs("div",{className:"bg-slate-700/30 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-slate-300 mb-1",children:["Your session: ",l.choiceCount," choices made"]}),l.qnceVariables&&e.jsxs("div",{className:"text-xs text-slate-400",children:["Variables: Curiosity ",l.qnceVariables.curiosity,", Coherence ",l.qnceVariables.coherence,", Disruption ",l.qnceVariables.disruption,", Synchrony ",l.qnceVariables.synchrony]})]})]});case"interface":case"onboarding":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-indigo-300",children:t==="interface"?"User Interface":"Getting Started"}),b(m[t]||0,s=>g(a=>({...a,[t]:s})),t==="interface"?"How intuitive was the interface":"How clear was the onboarding",t)]});case"suggestions":return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-indigo-300",children:"Your Suggestions"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"improvements-comment",className:"block text-slate-300 text-sm mb-2",children:"What could be improved?"}),e.jsx("textarea",{id:"improvements-comment",value:c.improvements,onChange:s=>d(a=>({...a,improvements:s.target.value})),placeholder:"Share your ideas for improvement...",className:"w-full p-3 bg-slate-700/50 border border-slate-600/50 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-400 resize-none",rows:2,maxLength:200})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"suggestions-comment",className:"block text-slate-300 text-sm mb-2",children:"Feature suggestions:"}),e.jsx("textarea",{id:"suggestions-comment",value:c.suggestions,onChange:s=>d(a=>({...a,suggestions:s.target.value})),placeholder:"What features would you like to see?",className:"w-full p-3 bg-slate-700/50 border border-slate-600/50 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-400 resize-none",rows:2,maxLength:200})]})]});default:return null}};return p?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"consolidated-feedback-title",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-60 backdrop-blur-sm transition-opacity duration-300",onClick:f,"aria-hidden":"true"}),e.jsxs("div",{className:"relative bg-gradient-to-br from-slate-800 to-slate-900 border border-indigo-500/30 rounded-xl shadow-2xl p-6 max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto transform transition-all duration-300",children:[e.jsx("button",{onClick:f,className:"absolute top-4 right-4 text-slate-400 hover:text-white transition-colors duration-200 z-10","aria-label":"Close feedback form",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"mb-6 pr-8",children:[e.jsx("h3",{id:"consolidated-feedback-title",className:"text-xl font-bold mb-2 bg-gradient-to-r from-indigo-300 to-purple-300 bg-clip-text text-transparent",children:i.consolidatedPrompt.title}),e.jsx("p",{className:"text-slate-300 text-sm",children:i.consolidatedPrompt.description}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("div",{className:"flex space-x-2",children:h.map((t,s)=>e.jsx("div",{className:`w-2 h-2 rounded-full transition-colors duration-200 ${s===r?"bg-indigo-400":s<r?"bg-indigo-600":"bg-slate-600"}`},s))})})]}),r===0&&i.consolidatedPrompt.quickOptions.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-slate-300 text-sm mb-3",children:"Quick feedback (select all that apply):"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:i.consolidatedPrompt.quickOptions.map((t,s)=>e.jsx("button",{onClick:()=>q(t),className:`p-3 rounded-lg text-sm text-left transition-all duration-200 ${u.includes(t)?"bg-indigo-600 text-white border border-indigo-500":"bg-slate-700/50 text-slate-300 hover:bg-slate-600/50 border border-slate-600/50"}`,"aria-pressed":u.includes(t),children:e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:`mr-2 ${u.includes(t)?"text-white":"text-slate-500"}`,children:u.includes(t)?"âœ“":"â—‹"}),t]})},s))})]}),h[r]&&e.jsx("div",{className:"mb-6",children:L(h[r])}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:()=>j(t=>Math.max(0,t-1)),disabled:S,className:`px-4 py-2 text-sm rounded-lg transition-colors duration-200 ${S?"text-slate-500 cursor-not-allowed":"text-indigo-300 hover:text-indigo-200 hover:bg-slate-700/50"}`,children:"Previous"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:f,className:"px-4 py-2 text-sm text-slate-400 hover:text-white transition-colors duration-200",disabled:x,children:"Skip"}),R?e.jsx("button",{onClick:$,disabled:x,className:"px-6 py-2 text-sm bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-lg font-semibold transition-all duration-300 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",title:"Submit your feedback - ratings are optional but helpful!",children:x?"Submitting...":"Submit Feedback"}):e.jsx("button",{onClick:()=>j(t=>t+1),className:"px-6 py-2 text-sm bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-lg font-semibold transition-all duration-300 shadow-lg",children:"Next"})]})]})]})]}):null};export{z as default};
